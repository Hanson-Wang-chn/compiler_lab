# 鲁棒性测试

## 功能说明

本测试程序验证词法分析器对各种边界情况、异常输入和特殊情况的处理能力，确保程序的鲁棒性。

## 测试类别

### 1. 空输入和空白处理
- 完全空的输入
- 只包含空格
- 只包含换行符
- 各种空白字符混合

**鲁棒性要求**：不崩溃，正确返回空结果或跳过空白。

### 2. 未闭合情况
- 未闭合的块注释：`/* comment`
- 未闭合的字符串：`"hello`
- 不完整的表达式：`int a = 1 +`

**鲁棒性要求**：
- 优雅处理到文件末尾
- 不产生段错误或数组越界
- 尽可能识别已有的有效Token

### 3. 边界情况
- 超长标识符
- 超大数字
- 紧邻的符号（无空格）
- 连续运算符（测试最长匹配）

**鲁棒性要求**：
- 正确处理任意长度的标识符和数字
- 正确处理无空格分隔的情况
- 最长匹配不出错

### 4. 特殊字符
- 中文字符（非ASCII）
- 非法符号（@、#等）
- 制表符

**鲁棒性要求**：
- 忽略非法字符并继续分析
- 正确处理制表符等空白字符
- 不因特殊字符崩溃

### 5. 嵌套和复杂情况
- 注释中的引号
- 字符串中的注释符号
- 转义字符

**鲁棒性要求**：
- 正确区分注释和字符串的边界
- 不误判嵌套的符号
- 正确处理转义序列

### 6. 极端情况
- 只有注释的文件
- 最小输入（单字符）
- 所有关键字连续

**鲁棒性要求**：
- 正常处理极小或极大的输入
- 正确识别所有情况

## 编译和运行

```bash
cd robustness_test
g++ -std=c++11 -o robustness_test robustness_test.cpp
./robustness_test
```

## 输出示例

```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
词法分析器鲁棒性测试
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

═══════════════════════════════════════
测试组 1: 空输入和空白处理
═══════════════════════════════════════

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
测试: 空输入
说明: 完全空的输入
输入: (空输入)
输出:
(无输出)
状态: ✓ 正常处理

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
测试: 未闭合块注释
说明: 注释没有结束符
输入: /* 这是一个未闭合的注释
输出:
1: </*注释*/,79>
状态: ✓ 正常处理

...

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
鲁棒性测试完成
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

总结：
- 词法分析器应能处理所有边界情况而不崩溃
- 对于非法输入，应优雅降级（跳过或忽略）
- 确保鲁棒性是高质量编译器的基础
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

## 鲁棒性设计策略

### 1. 边界检查
```cpp
char peek() {
    if (pos >= input.length()) return '\0';
    return input[pos];
}
```
- 防止数组越界
- 返回安全的默认值

### 2. 异常处理
```cpp
try {
    // 词法分析
} catch (...) {
    // 优雅降级
}
```
- 捕获异常，避免崩溃

### 3. 容错机制
```cpp
// 未识别字符，跳过
advance();
```
- 遇到非法字符不停止
- 继续分析后续内容

### 4. 安全的循环
```cpp
while (pos < input.length()) {
    // 保证终止条件
}
```
- 明确的终止条件
- 避免无限循环

## 评估标准

| 测试类型 | 期望行为 | 评分标准 |
|---------|---------|---------|
| 空输入 | 正常返回空结果 | 必须通过 |
| 未闭合注释 | 处理到文件末尾 | 必须通过 |
| 未闭合字符串 | 优雅处理 | 必须通过 |
| 非法字符 | 跳过并继续 | 必须通过 |
| 超长输入 | 正确处理 | 必须通过 |
| 极端情况 | 不崩溃 | 必须通过 |

## 重要性

鲁棒性是编译器质量的关键指标：
1. **用户体验**：不因输入错误而崩溃
2. **调试友好**：给出合理的错误提示
3. **生产就绪**：能处理现实中的各种代码
4. **安全性**：防止恶意输入攻击
